/*!
 * plum.shop v2.5
 * Copyright 2011-2012 Elia Fierro <http://plumjs.com>
 * Date: 13 October, 2012
 */
var plum=plum||{};(function(a){String.prototype.plum=Number.prototype.plum=a.fn.plum=function(e,c){var d=e.split("."),b;e=d[0];if(d.length>1){b=c;c=d[1]}return typeof plum[e]==="function"?plum[e].call(this,c,b):this};a.each(["before","after","append","html"],function(c,b){c=a.fn[b];a.fn[b]=function(e){var d=c.apply(this,arguments);this.trigger("plum",[d,e]);return d}});plum.shop=function(c){var b=plum.shop.prototype;if(this.selector&&(typeof c==="string"||c.cartitem)){a.each(this.selector.split(/\s*,\s*/),function(e,d){d=d.replace(/^\s+|\s+$/,"");b.carts[d]=(c.cartitem||c).toString()})}if(!this.selector||typeof c==="object"){b.init(c)}return this};plum.shop.prototype={cart:{items:[],timeout:null,shippingMethod:null,discountCode:null,country:null,region:null,each:function(e){var b,c,d=this.items.length;for(c=0;c<d;c++){b=e.call(this.items[c],c);if(b!==undefined&&b!==true){return b}}}},carts:{},shippingMenuPopulated:false,discount:0,shipping:0,subtotal:0,quantity:0,tax:0,total:0,options:{classes:{cartdiscount:"cart-discount",cartquantity:"cart-quantity",cartshipping:"cart-shipping",cartsubtotal:"cart-subtotal",carttax:"cart-tax",carttotal:"cart-total",discount:"discount",empty:"empty",id:"id",limit:"limit",price:"price",product:"product",purchase:"purchase",quantity:"quantity",taxable:"taxable",title:"title",shipping:"shipping",stock:"stock",remove:"remove"},currencyFormat:"$00,000.00",currencyCode:"USD",discountCodes:false,discountURL:"",geolocation:false,generateSKU:false,generateLimit:2,language:"EN",overrideProperties:false,properties:[],sandbox:false,shippingProperty:null,shippingRate:0,shippingType:"variable",shortCodes:{pricesingle:function(b){var d=this.options.classes;return this.formatPrice(b[d.price])},pricetotal:function(b){var d=this.options.classes;return this.formatPrice(b[d.price]*b[d.quantity])}},storage:"local,cookie,session",storageName:"plum_shop",storageURL:"",taxIncluded:false,taxRate:0,taxShipping:false,timeout:86400,addItemAfter:function(){},addItemBefore:function(){},buildCartAfter:function(){},buildCartBefore:function(){},calcDiscount:function(){},calcShipping:function(){},calcSubtotal:function(){},calcTax:function(){},calcTotal:function(){},emptyCartAfter:function(){},emptyCartBefore:function(){},itemSoldOut:function(){},ready:function(){},removeItemAfter:function(){},removeItemBefore:function(){},shippingChanged:function(){},updateItemAfter:function(){},updateItemBefore:function(){}},init:function(e){var b=this,h=this.options,j=h.classes,g=a(document),f;a.extend(true,h,e);this.saveCart=this.setStorageMethod(h.storage);if(this.saveCart){h.properties=a.merge([j.id,j.limit,j.price,j.quantity,j.stock,j.title],h.properties);this.shippingMenuPopulated=!!a("select."+j.shipping).children().length;this.saveCart(true);if(this.cart.timeout===null){this.cart.timeout=this.timeout(true)}if(h.geolocation){this.geolocation()}a("input."+j.discount).val(this.cart.discountCode);g.bind("plum","build",a.proxy(this.listen,this));g.delegate("."+j.purchase,"click","purchase",a.proxy(this.listen,this));g.delegate("."+j.empty,"click","empty",a.proxy(this.listen,this));g.delegate(":radio."+j.shipping+",select."+j.shipping,"change","shipping",a.proxy(this.listen,this));g.delegate("input."+j.discount,"change","discount",a.proxy(this.listen,this));for(f in this.checkout){if(this.checkout.hasOwnProperty(f)){g.delegate("."+(this.options.classes[f]||f),"click",f,a.proxy(this.checkout,this))}}a.each(this.carts,function(c){g.delegate(c+" ."+j.remove,"click","remove",a.proxy(b.listen,b));g.delegate(c+" :input","change","cart-options",a.proxy(b.listen,b));b.buildCart(c)});this.updateTotals();h.ready.call(this)}},buildCart:function(f){var b=this,e=this.options,c=this.carts[f],d;f=a(f);if(f.length&&e.buildCartBefore.call(this,f)!==false){d=a("<ul>");this.cart.each(function(){d.append(b.buildCartItem(this,c))});f.html(d);e.buildCartAfter.call(this,f)}},buildCartItem:function(e,d){var b=this,f=this.options,g=f.classes;if(d){a.each(d.match(/(\{[^\}\s]+\})/g),function(c,j){var h=j.substring(1,j.length-1);h=f.shortCodes[h]!==undefined?f.shortCodes[h].call(b,e,h):e[h];d=d.replace(new RegExp(j,"g"),h===undefined?"":h)});d=a('<li data-id="'+e[g.id]+'">'+d+"</li>");a(":input",d).each(function(){var c=a(this),i=this.className,h;if(i){a.each(i.split(" "),function(j,k){if(a.inArray(k,f.properties)&&e[k]!==undefined){h=e[k];return false}});if(h===undefined){c.remove()}else{c.val(h)}}else{c.remove()}})}return d},calcDiscount:function(d){var e=this.options,b=this,g,f,c;if(!d){d=a("."+e.classes.discount);d=d.length?d[0]:{}}if(d.value&&typeof e.discountCodes==="object"){if(e.discountCodes[d.value]!==undefined){g=e.discountCodes[d.value];g=this.calcDiscountAmount(g)}}else{if(d.value&&e.discountURL){c={quantity:this.quantity,subtotal:this.subtotal,tax:this.tax,shipping:this.shipping,discount:d.value};c[e.storageName]=true;a.ajax({url:e.discountURL,async:false,type:"GET",data:c,dataType:"json",success:function(h){if(h.discount!==undefined){g=b.calcDiscountAmount(h.discount)}}})}}if(g!==undefined){this.discount=g;this.cart.discountCode=d.value;a("."+e.classes.discount).val(d.value)}else{g=0;this.discount=0;this.cart.discountCode=null;d.value=""}f=e.calcDiscount.call(this,g,d.value);return f===undefined?g:f},calcDiscountAmount:function(b){b=typeof b==="function"?b.call(this):(/^\d+%$/.test(b)?this.subtotal*parseFloat(b)/100:b);if(!isNaN(b)){return b}},calcShipping:function(){var d=this,g=d.options,i=g.classes,b,f=a(),e=0,h;if(typeof g.shippingRate==="object"){b=a("select."+i.shipping);if(b.length){a.each(g.shippingRate,function(c,k){var j="";k=d.calcShippingRate(k);if(d.cart.shippingMethod===c){j=" selected";e=k}f=f.add('<option value="'+c+'" data-rate="'+k+'"'+j+">"+c+" ("+d.formatPrice(k)+")</option>")});if(this.shippingMenuPopulated){f=b.children().eq(0).clone().attr("disabled",true).add(f)}b.html(f).children().each(function(){if(this.selected){e=parseFloat(a(this).data("rate"));b.val(this.value);d.cart.shippingMethod=this.value;return false}})}else{e=a(":radio."+g.shipping+":checked").data("rate")}e=isNaN(e)?0:e}else{e=this.calcShippingRate(g.shippingRate)}h=g.calcShipping.call(this,e);return h===undefined?e:h},calcShippingRate:function(f){var e=this.quantity,j=this.subtotal,d=this.options,h=d.classes,b=0,i=0,k,g=d.shippingType.split(",");switch(g[0]){case"fixed":b=e*f;break;case"flat":b=f;break;case"range":k=d.shippingProperty?d.shippingProperty:h.price;g=g[1]||"flat";this.cart.each(function(){var c=parseFloat(this[k]);i+=k===h.quantity?c:(isNaN(c)?0:c)*this[h.quantity]});if(typeof f==="object"&&f!==null){a.each(f,function(c,l){c=parseFloat(c);c=isNaN(c)?0:c;if(i>=c){switch(g){case"fixed":b+=e*l;break;case"flat":b=l;break;default:b=j*l;break}}})}break;default:b=j*f;break}return b},calcSubtotal:function(){var e=this.options,g=e.classes,b=0,d=0,f;this.cart.each(function(){b+=this[g.price]*this[g.quantity];d+=this[g.quantity]});this.quantity=d;f=e.calcSubtotal.call(this,b);return f===undefined?b:f},calcTax:function(){var b=this,i,f=b.options,h=f.classes,d=[],e=0,g=f.taxShipping?this.shipping:0;taxRate=[];this.cart.each(function(){g+=this[h.taxable]?this[h.price]*this[h.quantity]:0});if(typeof f.taxRate==="object"){if(f.taxRate instanceof Array){a.each(f.taxRate,function(c,j){d.push(b.calcTaxAmount(g,j))});taxRate=f.taxRate}else{a.each(f.taxRate,function(j,c){j=j.split(":");if(b.cart.country===j[0]){if(!j[1]||(b.cart.region===j[1])){a.each(c,function(k,l){d.push(b.calcTaxAmount(g,l))});taxRate=c}}})}}a.each(d,function(c,j){e+=j});e=parseFloat(e.toFixed(2),d);i=f.calcTax.call(this,e,taxRate);return i===undefined?e:i},calcTaxAmount:function(c,b){return this.options.taxIncluded?c-c/((b+1)*100)*100:c*b},calcTotal:function(){var c=this.options,b=0,d;b=this.subtotal+this.shipping-this.discount+(c.taxIncluded?0:this.tax);d=c.calcTotal.call(this,b);b=d===undefined?b:d;return b<0?0:b},checkout:function(c,d){if(typeof c==="string"){var b=[];a.each(d,function(e,f){b.push('<input type="hidden" name="'+f[0]+'" value="'+f[1].toString()+'">')});a("<form>",{action:c,method:"post",css:{display:"none"},html:b.join("")}).appendTo("body").trigger("submit")}else{c.preventDefault();if(this.quantity){this.checkout[c.data].call(this)}}},emptyCart:function(b){var c=this.options;if(b){this.cart.items=[];this.cart.timeout=this.timeout(true);this.cart.discountCode=null;this.cart.shippingMethod=null;this[c.geolocation?"geolocation":"saveCart"](c.geolocation);a.each(this.carts,function(d){a(d).empty()})}else{if(this.cart.items&&this.cart.items.length&&c.emptyCartBefore.call(this)!==false){this.emptyCart(true);c.emptyCartAfter(true)}}},encodeJSON:function(b){var d=[],c;switch(typeof b){case"function":return this.escapeJSONString(b.toString());case"number":if(isNaN(b)){throw new Error()}return b;case"boolean":case"null":return b;case"string":return this.escapeJSONString(b);case"object":if(!b){return null}if(b instanceof Array){for(c in b){if(b.hasOwnProperty(c)){d.push(this.encodeJSON(b[c]))}}d="["+d.join(",")+"]"}else{for(c in b){if(b.hasOwnProperty(c)){d.push('"'+c+'":'+this.encodeJSON(b[c]))}}d="{"+d.join(",")+"}"}return d;default:throw new Error()}},escapeJSONString:function(b){var d=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,c={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};d.lastIndex=0;return'"'+(d.test(b)?b.replace(d,function(e){return typeof c[e]==="string"?c[e]:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}):b)+'"'},forceInt:function(c,b){c=c?parseInt(c,10):b;return isNaN(c)?b:c},formatPrice:function(e){var c=this.options.currencyFormat,f=c.replace(/^([^\d]+)?.+?$/,"$1"),g=c.replace(/^.+?([^\d]+)?$/,"$1"),d=c.substring(f.length,c.length-g.length),b=d.replace(/^.+?([^\d]+)\d{2}$/,"$1");b=b===d?"":b;d=b?d.substring(0,d.lastIndexOf(b)):d;d=d.split("").reverse();e=parseFloat(e||0).toFixed(2).toString().match(/^(.+?)(?:[^\d](\d\d))?$/);e[1]=e[1].replace(/[^\d]/g,"");e[2]=e[2]||0;e=parseFloat(e[1]+"."+e[2]).toFixed(2).split(".");e[0]=e[0].split("").reverse();c=[];a.each(d,function(h,j){c.push(/^\d+$/.test(j)?e[0].shift():j)});c=c.reverse().join("").replace(/^(?:[^\d]+)?(.+)(?:[^\d]+)?$/,"$1");e=f+c+(b?b+e[1]:"")+g;return e},geolocation:function(c){var b=this;if(c||!this.cart.country||!this.cart.region){a.getJSON("http://www.geoplugin.net/json.gp?jsoncallback=?",function(d){b.cart.country=d.geoplugin_countryCode;b.cart.region=d.geoplugin_regionCode||null;b.saveCart()})}b.saveCart()},insertItem:function(f){var b=this,g=b.options,h=g.classes,e,d;if(!f[h.id]){return false}f[h.taxable]=f[h.taxable]==="false"?false:true;e=this.itemExists(f);d=f[h.stock];if(e===false){d=d&&f[h.quantity]>d;if(d){g.itemSoldOut.call(this,f)}else{if(g.addItemBefore.call(this,f)!==false){this.cart.items.push(f);this.saveCart();g.addItemAfter.call(this,f)}}}else{if(f[h.quantity]+this.cart.items[e][h.quantity]<1){f=this.cart.items[e];if(g.removeItemBefore.call(this,f)!==false){this.cart.items.splice(e,1);this.saveCart();g.removeItemAfter.call(this,f)}}else{f[h.quantity]+=this.cart.items[e][h.quantity];if(f[h.limit]&&f[h.quantity]>f[h.limit]){f[h.quantity]=parseInt(f[h.limit])}d=d&&f[h.quantity]>d;if(d){g.itemSoldOut.call(this,f)}else{if(g.updateItemBefore.call(this,f)!==false){if(g.overrideProperties){a.extend(this.cart.items[e],f)}else{this.cart.items[e][h.quantity]=f[h.quantity]}this.saveCart();g.updateItemAfter.call(this,f)}}}}a.each(this.carts,function(c){b.buildCart(c)})},itemExists:function(d){var b=this.options.classes;d=(typeof d==="object"?d[b.id]:d).toString();d=this.cart.each(function(c){return this[b.id]===d?c:true});return d===undefined?false:d},listen:function(d,j,l){d.preventDefault();var t=this,g=t.options,n=g.classes,m=d.currentTarget,s={},p=0,r,q,f,k,e,b,h;switch(d.data){case"build":a(l).each(function(){j=a(this);a.each(t.carts,function(c){if(j.is(c)){t.buildCart(c)}})});break;case"cart-options":m=a(m);q=m[0].value;k=this.itemExists(m.closest("li[data-id]").data("id"));s=a.extend({},this.cart.items[k]);console.dir(s);a.each(m[0].className.split(/\s+/),function(c,o){if(a.inArray(o,g.properties)){r=o}});if(r===n.quantity){q=parseInt(q,10);q=isNaN(q)?-s[n.quantity]:q;s[n.quantity]=q-s[n.quantity]}else{if(r&&g.generateSKU){this.cart.items.splice(k,1);f=r.replace(/(?:\:|\|)/,"").substring(0,g.generateLimit).toUpperCase();s[n.id]=s[n.id].replace(new RegExp(f+s[r].replace(/(?:\:|\|)/,"").substring(0,g.generateLimit).toUpperCase()+"(\u007c|$)"),f+q.replace(/(?:\:|\|)/,"").substring(0,g.generateLimit).toUpperCase()+"$1");s[r]=q}else{if(r){s[n.quantity]=0;s[n.id]=this.cart.items[k][n.id];this.cart.items[k][r]=q}}}this.insertItem(s);break;case"discount":m.blur();this.saveCart(m);break;case"empty":this.emptyCart();break;case"purchase":b=a(m).closest("."+n.product)[0];h=this.options.generateSKU?[]:false;if(!b){return false}if(b.id){s[n.id]=b.id}a.each(b.attributes,function(i,c){i=c.nodeName;if(i.substring(0,5)==="data-"){i=i.substring(5);if(a.inArray(i,g.properties)>-1&&!s[i]){s[i]=c.nodeValue}}});a("[class]",b).each(function(){var i=this,c=this.nodeName.toLowerCase();j=a(i);a.each(this.className.split(/\s+/),function(o,u){if(a.inArray(u,g.properties)>-1&&!s[u]){s[u]=j.is(":radio")||j.is(":checkbox")?(i.checked?i.value:""):j.is(":input")?i.value:j.is("img")?i.src:j.text();if(c==="select"||((i.type==="radio"||i.type==="checkbox")&&i.checked)){if(c==="select"){j=j.find('option[value="'+s[u]+'"]');p+=j.data(n.price)?parseFloat(j.data(n.price)):0}else{if(j.data(n.price)){p+=parseFloat(j.data(n.price))}}if(h){h.push(u.replace(/(\:|\|)/g,"").substring(0,g.generateLimit)+s[u].replace(/(\:|\|)/g,"").substring(0,g.generateLimit))}}}})});if(h){h=h.join("|").toUpperCase();s[n.id]=!h?s[n.id]:s[n.id]?s[n.id]+":"+h:h}if(s[n.price]){s[n.price]=parseFloat(String(s[n.price]).replace(/[^\d\.]/g,"").match(/\d*(?:\.\d\d)?/));s[n.price]+=p}s[n.quantity]=this.forceInt(s[n.quantity],1);s[n.limit]=this.forceInt(s[n.limit],0);s[n.stock]=this.forceInt(s[n.stock],0);this.insertItem(s);break;case"remove":e=a(m).closest("li[data-id]").data("id");k=this.itemExists(e);if(k!==false){s[n.id]=e;s[n.quantity]=-this.cart.items[k][n.quantity];this.insertItem(s)}break;case"shipping":this.cart.shippingMethod=m.value;this.shipping=a(m).is("select")?a('option[value="'+m.value+'"]',m).data("rate"):a(m).data("rate");g.shippingChanged.call(this);this.saveCart();break}},setStorageMethod:function(b){var d,c=this.options.storageURL;a.each(b.split(","),function(g,h){h=h.replace(/^\s*(.+)\s*$/,"$1");switch(h){case"cookie":if(!d&&navigator.cookieEnabled){d="storageCookie"}break;case"local":if(!d&&!!window.localStorage){var f=true;try{window.localStorage.setItem("plum_shop_test","plum");window.localStorage.removeItem("plum_shop_test");d="storageLocal"}catch(j){f=false;d=null}}break;case"session":if(!d&&c){d="storageSession"}break}});if(d&&typeof this[d]==="function"){return this[d]}},storageCookie:function(c){var b=this.options.storageName,e,f,d;if(c===true){d=document.cookie.split(";");for(e in d){if(d[e]!==undefined){f=d[e];while(f.charAt(0)===" "){f=f.substring(1)}if(f.indexOf(b+"=")===0){f=decodeURIComponent(f.substring((b+"=").length));this.setupCart(f)}}}}else{f=encodeURIComponent(this.setCart(true));f=b+"="+f+"; path=/";if(f.length<=4058){document.cookie=f;this.updateTotals(c)}}},storageLocal:function(c){var b=this.options.storageName,d;if(c===true){d=window.localStorage.getItem(b);if(d){this.setupCart(d)}}else{window.localStorage.setItem(b,this.setCart(true));this.updateTotals(c)}},storageSession:function(d){var f=this.options,c=f.storageName,b=f.storageURL,e={};if(d===true){e[c]=true;a.ajax({url:b,async:false,type:"GET",data:e,dataType:"json",success:a.proxy(function(g){g.items=g.items||[];this.setupCart(g)},this)})}else{e[c]=this.setCart();a.post(b,e);this.updateTotals(d)}},setCart:function(c){var b={};a.each(this.cart,function(d,e){if(typeof e!=="function"){b[d]=e}});return c?this.encodeJSON(b):b},setupCart:function(c){var b=this;c=typeof c==="object"?c:/^\{".+\}$/.test(c)?a.parseJSON(c):{items:[],country:null,region:null,timeout:this.timeout(true),discountCode:null,shippingMethod:null};a.each(c,function(d,e){b.cart[d]=e});this.cart.items=c.items||[];this.cart.timeout=parseInt(c.timeout,10);this.cart.each(function(){this.price=Number(this.price);this.quantity=Number(this.quantity);this.stock=Number(this.stock)});this.timeout()},timeout:function(b){var c=this.options.timeout,e;if(b){e=new Date();e.setDate(e.getUTCDate()+c/86400);return Date.parse(e.toUTCString())}if(!this.cart.timeout||(this.timeout(true)>parseInt(this.cart.timeout,10)+c*1000)){this.emptyCart(true)}},updateTotals:function(b){var d=this,e=d.options.classes;d.subtotal=parseFloat(d.calcSubtotal().toFixed(2));d.shipping=parseFloat(d.calcShipping().toFixed(2));d.tax=parseFloat(d.calcTax().toFixed(2));d.discount=parseFloat(d.calcDiscount(b).toFixed(2));d.total=parseFloat(d.calcTotal().toFixed(2));a("."+e.cartquantity).each(function(){this.innerHTML=d.quantity.toString()});a("."+e.cartsubtotal).each(function(){this.innerHTML=d.formatPrice(d.subtotal)});a("."+e.cartshipping).each(function(){this.innerHTML=d.formatPrice(d.shipping)});a("."+e.carttax).each(function(){this.innerHTML=d.formatPrice(d.tax)});a("."+e.cartdiscount).each(function(){this.innerHTML="-"+d.formatPrice(d.discount)});a("."+e.carttotal).each(function(){this.innerHTML=d.formatPrice(d.total)})}};plum.shop.prototype.checkout.checkout=function(){if((this.options.checkout||function(){}).call(this)===true){this.emptyCart(true)}};
/*! Amazon FPS extension for plum.shop | @since 1.3 */
plum.shop.prototype.checkout.amazon=function(){var h=this.options,i=h.classes,b,d=0,g=[],e=new RegExp("^(?:"+i.id+"|"+i.limit+"|"+i.price+"|"+i.quantity+"|"+i.taxable+"|"+i.title+"|"+i.stock+")$"),f=h.amazonmerchant;if(!/[A-Z0-9]{14}/.test(f)){return false}this.cart.each(function(k){var j,c=1,l=[];k++;g.push(["item_merchant_id_"+k,f]);g.push(["item_sku_"+k,this[i.id].substring(0,40)]);g.push(["item_title_"+k,this[i.title]]);g.push(["item_price_"+k,this[i.price]]);g.push(["item_quantity_"+k,this[i.quantity]]);for(j in this){if(this[j]!==undefined&&!e.test(j)){g.push(["item_"+k+".custom_attribute_"+c+"."+j,this[j]]);l.push(j+": "+this[j])}}if(l.length){g.push(["item_description_"+k,l])}});if(this.discount){g.push(["cart_promotion_1",this.discount]);g.push(["cart_promotion_type_1","fixed_amount_off"])}if(!h.taxIncluded&&this.tax){b=h.taxRate instanceof Array||typeof h.taxRate==="number"?h.taxRate:h.taxRate[this.cart.country+(this.cart.region?":"+this.cart.region:"")];if(b){if(b instanceof Array){a.each(b,function(j,c){d+=c})}else{b=d}g.push(["is_shipping_taxed",h.taxShipping?true:false]);g.push(["tax_rate",d])}}if(this.shipping){g.push(["shipping_method_service_level_1","standard"]);g.push(["shipping_method_price_per_shipment_amount_1",this.shipping])}g.push(["currency_code",h.currencyCode]);this.checkout("https://payments"+(h.sandbox?"-sandbox":"")+".amazon.com/checkout/"+f,g)};
/*! Google Checkout extension for plum.shop | @since 1.0 */
plum.shop.prototype.checkout.google=function(f){var j=this.cart.items.length+1,h=this.options,n=h.classes,k=0,p,l=[],m=new RegExp("^(?:"+n.id+"|"+n.limit+"|"+n.price+"|"+n.quantity+"|"+n.taxable+"|"+n.title+"|"+n.stock+")$"),e="checkout-flow-support.merchant-checkout-flow-support.",d=e+"tax-tables.default-tax-table.tax-rules.default-tax-rule-1.",b=e+"shipping-methods.flat-rate-shipping-1.",g=h.googlemerchant;if(!/^[\d]{10,15}$/.test(g)){return false}this.cart.each(function(q){var c=[],o;q++;l.push(["item_merchant_id_"+q,this[n.id]]);l.push(["item_name_"+q,this[n.title]||""]);l.push(["item_quantity_"+q,this[n.quantity]]);l.push(["item_price_"+q,this[n.price]]);l.push(["item_currency_"+q,h.currencyCode]);for(o in this){if(this[o]!==undefined&&!m.test(o)){c.push(o+": "+this[o])}}l.push(["item_description_"+q,c.length?c.join(", "):""])});if(this.discount){l.push(["item_merchant_id_"+j,this.cart.discountCode||0]);l.push(["item_name_"+j,this.cart.discountCode||this.format(-this.discount)]);l.push(["item_description_"+j,this.cart.discountCode]);l.push(["item_quantity_"+j,1]);l.push(["item_price_"+j,-this.discount]);l.push(["item_currency_"+j,h.currencyCode])}if(!h.taxIncluded&&this.tax&&typeof h.taxRate==="object"){p=h.taxRate[this.cart.country+(this.cart.region?":"+this.cart.region:"")];if(p){if(p instanceof Array){a.each(p,function(i,c){k+=c})}else{k=p}l.push([d+"shipping-taxed",h.taxShipping?true:false]);l.push([d+"rate",k]);if(this.cart.region){l.push([d+"tax-areas.us-state-area-1.state",this.cart.region])}else{l.push([d+"tax-area.postal-area.country-code",this.cart.country])}}}if(this.shipping){l.push([b+"name",this.cart.shippingMethod]);l.push([b+"price",this.shipping]);l.push([b+"price.currency",h.currencyCode])}if(f){l.push(["shopping-cart.merchant-private-data","invoice: "+f])}this.checkout((h.sandbox?"https://sandbox.google.com/checkout/api/checkout/v2/checkoutForm/Merchant/":"https://checkout.google.com/api/checkout/v2/checkoutForm/Merchant/")+g,l)};
/*! PayPal extension for plum.shop | @since 1.0 */
plum.shop.prototype.checkout.paypal=function(j){var b=0,g=this.options,h=g.classes,f=[],d=new RegExp("^(?:"+h.id+"|"+h.limit+"|"+h.price+"|"+h.quantity+"|"+h.taxable+"|"+h.title+"|"+h.stock+")$"),e={user:g.paypaluser,domain:g.paypaldomain};if(!e.user||!e.domain){return false}this.cart.each(function(){var i,c=0;b++;f.push(["item_number_"+b,this[h.id]]);f.push(["item_name_"+b,this[h.title]||this[h.id]]);f.push(["quantity_"+b,this[h.quantity]]);f.push(["amount_"+b,this[h.price]]);for(i in this){if(this[i]!==undefined&&!d.test(i)&&c<7){f.push(["on"+c+"_"+b,i]);f.push(["os"+c+++"_"+b,this[i]])}}});if(this.discount){f.push(["discount_amount_cart",this.discount])}if(!g.taxIncluded&&this.tax){f.push(["tax_cart",this.tax])}if(this.shipping){f.push(["custom","shippingMethod: "+this.cart.shippingMethod]);f.push(["handling_cart",this.shipping])}f.push(["cmd","_cart"]);f.push(["lc",g.language]);f.push(["upload","1"]);f.push(["charset","utf-8"]);f.push(["currency_code",g.currencyCode]);f.push(["business",g.paypaluser+"@"+g.paypaldomain]);if(g.headerurl){f.push(["cpp_header_image",g.headerurl])}if(g.cancelurl){f.push(["cancel_return",g.cancelurl])}if(g.returnurl){f.push(["return",g.returnurl])}if(g.notifyurl){f.push(["notify_url",g.notifyurl])}if(j){f.push(["invoice",j])}this.checkout("https://www."+(g.sandbox?"sandbox.":"")+"paypal.com/cgi-bin/webscr",f)};
/*! Skrill extension for plum.shop | @since 1.1 */
plum.shop.prototype.checkout.skrill=function(j){var b=0,g=this.options,h=g.classes,f=[],d=new RegExp("^(?:"+h.limit+"|"+h.price+"|"+h.taxable+"|"+h.title+"|"+h.stock+")$"),e={user:g.skrilluser,domain:g.skrilldomain};if(!e.user||!e.domain){return false}this.cart.each(function(){var i,c=[];b++;f.push(["detail"+b+"_description",this[h.title]]);for(i in this){if(this[i]!==undefined&&!d.test(i)){c.push(i+": "+this[i])}}f.push(["detail"+b+"_text",c.join(", ")])});b=2;if(this.discount){f.push(["amount"+b+"_description",this.cart.discountCode||""]);f.push(["amount"+b++,(-this.discount).toFixed(2)])}if(!g.taxIncluded&&this.tax){f.push(["amount"+b+"_description","Tax"]);f.push(["amount"+b++,this.tax.toFixed(2)])}if(this.shipping){f.push(["amount"+b+"_description",this.cart.shippingMethod]);f.push(["amount"+b++,this.shipping.toFixed(2)])}f.push(["amount",this.total.toFixed(2)]);f.push(["language",g.language]);f.push(["currency",g.currencyCode]);f.push(["pay_to_email",e.user+"@"+e.domain]);if(g.headerurl){f.push(["logo_url",g.headerurl])}if(g.cancelurl){f.push(["cancel_url",g.cancelurl])}if(g.returnurl){f.push(["return_url",g.returnurl])}if(g.notifyurl){f.push(["status_url",g.notifyurl])}if(j){f.push(["transaction_id",j])}this.checkout("https://www.moneybookers.com/app/payment.pl",f)}}(jQuery));