/*!
 * plum.shop v2.5
 * Copyright 2011-2012 Elia Fierro <http://plumjs.com>
 * Date: 13 October, 2012
 */
(function(a,b){plum.shop=function(d){var c=plum.shop.prototype;if(this.selector&&(typeof d==="string"||d.cartitem)){a.each(this.selector.split(/\s*,\s*/),function(f,e){e=e.replace(/^\s+|\s+$/,"");c.carts[e]=(d.cartitem||d).toString()})}if(!this.selector||typeof d==="object"){c.init(d)}return this};plum.shop.prototype={cart:{items:[],timeout:null,shippingMethod:null,discountCode:null,country:null,region:null,each:function(f){var c,d,e=this.items.length;for(d=0;d<e;d++){c=f.call(this.items[d],d);if(c!==b&&c!==true){return c}}}},carts:{},shippingMenuPopulated:false,discount:0,shipping:0,subtotal:0,quantity:0,tax:0,total:0,options:{classes:{cartdiscount:"cart-discount",cartquantity:"cart-quantity",cartshipping:"cart-shipping",cartsubtotal:"cart-subtotal",carttax:"cart-tax",carttotal:"cart-total",discount:"discount",empty:"empty",id:"id",limit:"limit",price:"price",product:"product",purchase:"purchase",quantity:"quantity",taxable:"taxable",title:"title",shipping:"shipping",stock:"stock",remove:"remove"},currencyFormat:"$00,000.00",currencyCode:"USD",discountCodes:false,discountURL:"",geolocation:false,generateSKU:false,generateLimit:2,language:"EN",overrideProperties:false,properties:[],sandbox:false,shippingProperty:null,shippingRate:0,shippingType:"variable",shortCodes:{pricesingle:function(d){var e=this.options.classes;return this.formatPrice(d[e.price])},pricetotal:function(d){var e=this.options.classes;return this.formatPrice(d[e.price]*d[e.quantity])}},storage:"local,cookie,session",storageName:"plum_shop",storageURL:"",taxIncluded:false,taxRate:0,taxShipping:false,timeout:86400,addItemAfter:function(){},addItemBefore:function(){},buildCartAfter:function(){},buildCartBefore:function(){},calcDiscount:function(){},calcShipping:function(){},calcSubtotal:function(){},calcTax:function(){},calcTotal:function(){},emptyCartAfter:function(){},emptyCartBefore:function(){},itemSoldOut:function(){},ready:function(){},removeItemAfter:function(){},removeItemBefore:function(){},shippingChanged:function(){},updateItemAfter:function(){},updateItemBefore:function(){}},init:function(f){var e=this,j=this.options,k=j.classes,h=a(document),g;a.extend(true,j,f);this.saveCart=this.setStorageMethod(j.storage);if(this.saveCart){j.properties=a.merge([k.id,k.limit,k.price,k.quantity,k.stock,k.title],j.properties);this.shippingMenuPopulated=!!a("select."+k.shipping).children().length;this.saveCart(true);if(this.cart.timeout===null){this.cart.timeout=this.timeout(true)}if(j.geolocation){this.geolocation()}a("input."+k.discount).val(this.cart.discountCode);h.bind("plum","build",a.proxy(this.listen,this));h.delegate("."+k.purchase,"click","purchase",a.proxy(this.listen,this));h.delegate("."+k.empty,"click","empty",a.proxy(this.listen,this));h.delegate(":radio."+k.shipping+",select."+k.shipping,"change","shipping",a.proxy(this.listen,this));h.delegate("input."+k.discount,"change","discount",a.proxy(this.listen,this));for(g in this.checkout){if(this.checkout.hasOwnProperty(g)){h.delegate("."+(this.options.classes[g]||g),"click",g,a.proxy(this.checkout,this))}}a.each(this.carts,function(c){h.delegate(c+" ."+k.remove,"click","remove",a.proxy(e.listen,e));h.delegate(c+" :input","change","cart-options",a.proxy(e.listen,e));e.buildCart(c)});this.updateTotals();j.ready.call(this)}},buildCart:function(g){var c=this,f=this.options,d=this.carts[g],e;g=a(g);if(g.length&&f.buildCartBefore.call(this,g)!==false){e=a("<ul>");this.cart.each(function(){e.append(c.buildCartItem(this,d))});g.html(e);f.buildCartAfter.call(this,g)}},buildCartItem:function(f,e){var d=this,g=this.options,h=g.classes;if(e){a.each(e.match(/(\{[^\}\s]+\})/g),function(c,k){var j=k.substring(1,k.length-1);j=g.shortCodes[j]!==b?g.shortCodes[j].call(d,f,j):f[j];e=e.replace(new RegExp(k,"g"),j===b?"":j)});e=a('<li data-id="'+f[h.id]+'">'+e+"</li>");a(":input",e).each(function(){var c=a(this),j=this.className,i;if(j){a.each(j.split(" "),function(k,l){if(a.inArray(l,g.properties)&&f[l]!==b){i=f[l];return false}});if(i===b){c.remove()}else{c.val(i)}}else{c.remove()}})}return e},calcDiscount:function(e){var f=this.options,c=this,h,g,d;if(!e){e=a("."+f.classes.discount);e=e.length?e[0]:{}}if(e.value&&typeof f.discountCodes==="object"){if(f.discountCodes[e.value]!==b){h=f.discountCodes[e.value];h=this.calcDiscountAmount(h)}}else{if(e.value&&f.discountURL){d={quantity:this.quantity,subtotal:this.subtotal,tax:this.tax,shipping:this.shipping,discount:e.value};d[f.storageName]=true;a.ajax({url:f.discountURL,async:false,type:"GET",data:d,dataType:"json",success:function(i){if(i.discount!==b){h=c.calcDiscountAmount(i.discount)}}})}}if(h!==b){this.discount=h;this.cart.discountCode=e.value;a("."+f.classes.discount).val(e.value)}else{h=0;this.discount=0;this.cart.discountCode=null;e.value=""}g=f.calcDiscount.call(this,h,e.value);return g===b?h:g},calcDiscountAmount:function(c){c=typeof c==="function"?c.call(this):(/^\d+%$/.test(c)?this.subtotal*parseFloat(c)/100:c);if(!isNaN(c)){return c}},calcShipping:function(){var e=this,h=e.options,j=h.classes,d,g=a(),f=0,i;if(typeof h.shippingRate==="object"){d=a("select."+j.shipping);if(d.length){a.each(h.shippingRate,function(c,l){var k="";l=e.calcShippingRate(l);if(e.cart.shippingMethod===c){k=" selected";f=l}g=g.add('<option value="'+c+'" data-rate="'+l+'"'+k+">"+c+" ("+e.formatPrice(l)+")</option>")});if(this.shippingMenuPopulated){g=d.children().eq(0).clone().attr("disabled",true).add(g)}d.html(g).children().each(function(){if(this.selected){f=parseFloat(a(this).data("rate"));d.val(this.value);e.cart.shippingMethod=this.value;return false}})}else{f=a(":radio."+h.shipping+":checked").data("rate")}f=isNaN(f)?0:f}else{f=this.calcShippingRate(h.shippingRate)}i=h.calcShipping.call(this,f);return i===b?f:i},calcShippingRate:function(g){var f=this.quantity,k=this.subtotal,e=this.options,i=e.classes,d=0,j=0,l,h=e.shippingType.split(",");switch(h[0]){case"fixed":d=f*g;break;case"flat":d=g;break;case"range":l=e.shippingProperty?e.shippingProperty:i.price;h=h[1]||"flat";this.cart.each(function(){var c=parseFloat(this[l]);j+=l===i.quantity?c:(isNaN(c)?0:c)*this[i.quantity]});if(typeof g==="object"&&g!==null){a.each(g,function(c,m){c=parseFloat(c);c=isNaN(c)?0:c;if(j>=c){switch(h){case"fixed":d+=f*m;break;case"flat":d=m;break;default:d=k*m;break}}})}break;default:d=k*g;break}return d},calcSubtotal:function(){var f=this.options,h=f.classes,d=0,e=0,g;this.cart.each(function(){d+=this[h.price]*this[h.quantity];e+=this[h.quantity]});this.quantity=e;g=f.calcSubtotal.call(this,d);return g===b?d:g},calcTax:function(){var d=this,j,g=d.options,i=g.classes,e=[],f=0,h=g.taxShipping?this.shipping:0;taxRate=[];this.cart.each(function(){h+=this[i.taxable]?this[i.price]*this[i.quantity]:0});if(typeof g.taxRate==="object"){if(g.taxRate instanceof Array){a.each(g.taxRate,function(c,k){e.push(d.calcTaxAmount(h,k))});taxRate=g.taxRate}else{a.each(g.taxRate,function(k,c){k=k.split(":");if(d.cart.country===k[0]){if(!k[1]||(d.cart.region===k[1])){a.each(c,function(l,m){e.push(d.calcTaxAmount(h,m))});taxRate=c}}})}}a.each(e,function(c,k){f+=k});f=parseFloat(f.toFixed(2),e);j=g.calcTax.call(this,f,taxRate);return j===b?f:j},calcTaxAmount:function(d,c){return this.options.taxIncluded?d-d/((c+1)*100)*100:d*c},calcTotal:function(){var d=this.options,c=0,e;c=this.subtotal+this.shipping-this.discount+(d.taxIncluded?0:this.tax);e=d.calcTotal.call(this,c);c=e===b?c:e;return c<0?0:c},checkout:function(d,e){if(typeof d==="string"){var c=[];a.each(e,function(f,g){c.push('<input type="hidden" name="'+g[0]+'" value="'+g[1].toString()+'">')});a("<form>",{action:d,method:"post",css:{display:"none"},html:c.join("")}).appendTo("body").trigger("submit")}else{d.preventDefault();if(this.quantity){this.checkout[d.data].call(this)}}},emptyCart:function(c){var d=this.options;if(c){this.cart.items=[];this.cart.timeout=this.timeout(true);this.cart.discountCode=null;this.cart.shippingMethod=null;this[d.geolocation?"geolocation":"saveCart"](d.geolocation);a.each(this.carts,function(e){a(e).empty()})}else{if(this.cart.items&&this.cart.items.length&&d.emptyCartBefore.call(this)!==false){this.emptyCart(true);d.emptyCartAfter(true)}}},encodeJSON:function(c){var e=[],d;switch(typeof c){case"function":return this.escapeJSONString(c.toString());case"number":if(isNaN(c)){throw new Error()}return c;case"boolean":case"null":return c;case"string":return this.escapeJSONString(c);case"object":if(!c){return null}if(c instanceof Array){for(d in c){if(c.hasOwnProperty(d)){e.push(this.encodeJSON(c[d]))}}e="["+e.join(",")+"]"}else{for(d in c){if(c.hasOwnProperty(d)){e.push('"'+d+'":'+this.encodeJSON(c[d]))}}e="{"+e.join(",")+"}"}return e;default:throw new Error()}},escapeJSONString:function(c){var e=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,d={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};e.lastIndex=0;return'"'+(e.test(c)?c.replace(e,function(f){return typeof d[f]==="string"?d[f]:"\\u"+("0000"+f.charCodeAt(0).toString(16)).slice(-4)}):c)+'"'},forceInt:function(d,c){d=d?parseInt(d,10):c;return isNaN(d)?c:d},formatPrice:function(f){var d=this.options.currencyFormat,g=d.replace(/^([^\d]+)?.+?$/,"$1"),h=d.replace(/^.+?([^\d]+)?$/,"$1"),e=d.substring(g.length,d.length-h.length),c=e.replace(/^.+?([^\d]+)\d{2}$/,"$1");c=c===e?"":c;e=c?e.substring(0,e.lastIndexOf(c)):e;e=e.split("").reverse();f=parseFloat(f||0).toFixed(2).toString().match(/^(.+?)(?:[^\d](\d\d))?$/);f[1]=f[1].replace(/[^\d]/g,"");f[2]=f[2]||0;f=parseFloat(f[1]+"."+f[2]).toFixed(2).split(".");f[0]=f[0].split("").reverse();d=[];a.each(e,function(j,k){d.push(/^\d+$/.test(k)?f[0].shift():k)});d=d.reverse().join("").replace(/^(?:[^\d]+)?(.+)(?:[^\d]+)?$/,"$1");f=g+d+(c?c+f[1]:"")+h;return f},geolocation:function(d){var c=this;if(d||!this.cart.country||!this.cart.region){a.getJSON("http://www.geoplugin.net/json.gp?jsoncallback=?",function(e){c.cart.country=e.geoplugin_countryCode;c.cart.region=e.geoplugin_regionCode||null;c.saveCart()})}c.saveCart()},insertItem:function(g){var d=this,h=d.options,j=h.classes,f,e;if(!g[j.id]){return false}g[j.taxable]=g[j.taxable]==="false"?false:true;f=this.itemExists(g);e=g[j.stock];if(f===false){e=e&&g[j.quantity]>e;if(e){h.itemSoldOut.call(this,g)}else{if(h.addItemBefore.call(this,g)!==false){this.cart.items.push(g);this.saveCart();h.addItemAfter.call(this,g)}}}else{if(g[j.quantity]+this.cart.items[f][j.quantity]<1){g=this.cart.items[f];if(h.removeItemBefore.call(this,g)!==false){this.cart.items.splice(f,1);this.saveCart();h.removeItemAfter.call(this,g)}}else{g[j.quantity]+=this.cart.items[f][j.quantity];if(g[j.limit]&&g[j.quantity]>g[j.limit]){g[j.quantity]=parseInt(g[j.limit])}e=e&&g[j.quantity]>e;if(e){h.itemSoldOut.call(this,g)}else{if(h.updateItemBefore.call(this,g)!==false){if(h.overrideProperties){a.extend(this.cart.items[f],g)}else{this.cart.items[f][j.quantity]=g[j.quantity]}this.saveCart();h.updateItemAfter.call(this,g)}}}}a.each(this.carts,function(c){d.buildCart(c)})},itemExists:function(e){var d=this.options.classes;e=(typeof e==="object"?e[d.id]:e).toString();e=this.cart.each(function(c){return this[d.id]===e?c:true});return e===b?false:e},listen:function(e,k,m){e.preventDefault();var u=this,h=u.options,p=h.classes,n=e.currentTarget,t={},q=0,s,r,g,l,f,d,j;switch(e.data){case"build":a(m).each(function(){k=a(this);a.each(u.carts,function(c){if(k.is(c)){u.buildCart(c)}})});break;case"cart-options":n=a(n);r=n[0].value;l=this.itemExists(n.closest("li[data-id]").data("id"));t=a.extend({},this.cart.items[l]);console.dir(t);a.each(n[0].className.split(/\s+/),function(c,o){if(a.inArray(o,h.properties)){s=o}});if(s===p.quantity){r=parseInt(r,10);r=isNaN(r)?-t[p.quantity]:r;t[p.quantity]=r-t[p.quantity]}else{if(s&&h.generateSKU){this.cart.items.splice(l,1);g=s.replace(/(?:\:|\|)/,"").substring(0,h.generateLimit).toUpperCase();t[p.id]=t[p.id].replace(new RegExp(g+t[s].replace(/(?:\:|\|)/,"").substring(0,h.generateLimit).toUpperCase()+"(\u007c|$)"),g+r.replace(/(?:\:|\|)/,"").substring(0,h.generateLimit).toUpperCase()+"$1");t[s]=r}else{if(s){t[p.quantity]=0;t[p.id]=this.cart.items[l][p.id];this.cart.items[l][s]=r}}}this.insertItem(t);break;case"discount":n.blur();this.saveCart(n);break;case"empty":this.emptyCart();break;case"purchase":d=a(n).closest("."+p.product)[0];j=this.options.generateSKU?[]:false;if(!d){return false}if(d.id){t[p.id]=d.id}a.each(d.attributes,function(i,c){i=c.nodeName;if(i.substring(0,5)==="data-"){i=i.substring(5);if(a.inArray(i,h.properties)>-1&&!t[i]){t[i]=c.nodeValue}}});a("[class]",d).each(function(){var i=this,c=this.nodeName.toLowerCase();k=a(i);a.each(this.className.split(/\s+/),function(o,v){if(a.inArray(v,h.properties)>-1&&!t[v]){t[v]=k.is(":radio")||k.is(":checkbox")?(i.checked?i.value:""):k.is(":input")?i.value:k.is("img")?i.src:k.text();if(c==="select"||((i.type==="radio"||i.type==="checkbox")&&i.checked)){if(c==="select"){k=k.find('option[value="'+t[v]+'"]');q+=k.data(p.price)?parseFloat(k.data(p.price)):0}else{if(k.data(p.price)){q+=parseFloat(k.data(p.price))}}if(j){j.push(v.replace(/(\:|\|)/g,"").substring(0,h.generateLimit)+t[v].replace(/(\:|\|)/g,"").substring(0,h.generateLimit))}}}})});if(j){j=j.join("|").toUpperCase();t[p.id]=!j?t[p.id]:t[p.id]?t[p.id]+":"+j:j}if(t[p.price]){t[p.price]=parseFloat(String(t[p.price]).replace(/[^\d\.]/g,"").match(/\d*(?:\.\d\d)?/));t[p.price]+=q}t[p.quantity]=this.forceInt(t[p.quantity],1);t[p.limit]=this.forceInt(t[p.limit],0);t[p.stock]=this.forceInt(t[p.stock],0);this.insertItem(t);break;case"remove":f=a(n).closest("li[data-id]").data("id");l=this.itemExists(f);if(l!==false){t[p.id]=f;t[p.quantity]=-this.cart.items[l][p.quantity];this.insertItem(t)}break;case"shipping":this.cart.shippingMethod=n.value;this.shipping=a(n).is("select")?a('option[value="'+n.value+'"]',n).data("rate"):a(n).data("rate");h.shippingChanged.call(this);this.saveCart();break}},setStorageMethod:function(c){var e,d=this.options.storageURL;a.each(c.split(","),function(g,h){h=h.replace(/^\s*(.+)\s*$/,"$1");switch(h){case"cookie":if(!e&&navigator.cookieEnabled){e="storageCookie"}break;case"local":if(!e&&!!window.localStorage){var f=true;try{window.localStorage.setItem("plum_shop_test","plum");window.localStorage.removeItem("plum_shop_test");e="storageLocal"}catch(j){f=false;e=null}}break;case"session":if(!e&&d){e="storageSession"}break}});if(e&&typeof this[e]==="function"){return this[e]}},storageCookie:function(d){var c=this.options.storageName,f,g,e;if(d===true){e=document.cookie.split(";");for(f in e){if(e[f]!==b){g=e[f];while(g.charAt(0)===" "){g=g.substring(1)}if(g.indexOf(c+"=")===0){g=decodeURIComponent(g.substring((c+"=").length));this.setupCart(g)}}}}else{g=encodeURIComponent(this.setCart(true));g=c+"="+g+"; path=/";if(g.length<=4058){document.cookie=g;this.updateTotals(d)}}},storageLocal:function(d){var c=this.options.storageName,e;if(d===true){e=window.localStorage.getItem(c);if(e){this.setupCart(e)}}else{window.localStorage.setItem(c,this.setCart(true));this.updateTotals(d)}},storageSession:function(e){var g=this.options,d=g.storageName,c=g.storageURL,f={};if(e===true){f[d]=true;a.ajax({url:c,async:false,type:"GET",data:f,dataType:"json",success:a.proxy(function(h){h.items=h.items||[];this.setupCart(h)},this)})}else{f[d]=this.setCart();a.post(c,f);this.updateTotals(e)}},setCart:function(d){var c={};a.each(this.cart,function(e,f){if(typeof f!=="function"){c[e]=f}});return d?this.encodeJSON(c):c},setupCart:function(d){var c=this;d=typeof d==="object"?d:/^\{".+\}$/.test(d)?a.parseJSON(d):{items:[],country:null,region:null,timeout:this.timeout(true),discountCode:null,shippingMethod:null};a.each(d,function(e,f){c.cart[e]=f});this.cart.items=d.items||[];this.cart.timeout=parseInt(d.timeout,10);this.cart.each(function(){this.price=Number(this.price);this.quantity=Number(this.quantity);this.stock=Number(this.stock)});this.timeout()},timeout:function(c){var e=this.options.timeout,f;if(c){f=new Date();f.setDate(f.getUTCDate()+e/86400);return Date.parse(f.toUTCString())}if(!this.cart.timeout||(this.timeout(true)>parseInt(this.cart.timeout,10)+e*1000)){this.emptyCart(true)}},updateTotals:function(d){var e=this,f=e.options.classes;e.subtotal=parseFloat(e.calcSubtotal().toFixed(2));e.shipping=parseFloat(e.calcShipping().toFixed(2));e.tax=parseFloat(e.calcTax().toFixed(2));e.discount=parseFloat(e.calcDiscount(d).toFixed(2));e.total=parseFloat(e.calcTotal().toFixed(2));a("."+f.cartquantity).each(function(){this.innerHTML=e.quantity.toString()});a("."+f.cartsubtotal).each(function(){this.innerHTML=e.formatPrice(e.subtotal)});a("."+f.cartshipping).each(function(){this.innerHTML=e.formatPrice(e.shipping)});a("."+f.carttax).each(function(){this.innerHTML=e.formatPrice(e.tax)});a("."+f.cartdiscount).each(function(){this.innerHTML="-"+e.formatPrice(e.discount)});a("."+f.carttotal).each(function(){this.innerHTML=e.formatPrice(e.total)})}};plum.shop.prototype.checkout.checkout=function(){if((this.options.checkout||function(){}).call(this)===true){this.emptyCart(true)}};
/*! Amazon FPS extension for plum.shop | @since 1.3 */
plum.shop.prototype.checkout.amazon=function(){var i=this.options,j=i.classes,d,e=0,h=[],f=new RegExp("^(?:"+j.id+"|"+j.limit+"|"+j.price+"|"+j.quantity+"|"+j.taxable+"|"+j.title+"|"+j.stock+")$"),g=i.amazonmerchant;if(!/[A-Z0-9]{14}/.test(g)){return false}this.cart.each(function(l){var k,c=1,m=[];l++;h.push(["item_merchant_id_"+l,g]);h.push(["item_sku_"+l,this[j.id].substring(0,40)]);h.push(["item_title_"+l,this[j.title]]);h.push(["item_price_"+l,this[j.price]]);h.push(["item_quantity_"+l,this[j.quantity]]);for(k in this){if(this[k]!==b&&!f.test(k)){h.push(["item_"+l+".custom_attribute_"+c+"."+k,this[k]]);m.push(k+": "+this[k])}}if(m.length){h.push(["item_description_"+l,m])}});if(this.discount){h.push(["cart_promotion_1",this.discount]);h.push(["cart_promotion_type_1","fixed_amount_off"])}if(!i.taxIncluded&&this.tax){d=i.taxRate instanceof Array||typeof i.taxRate==="number"?i.taxRate:i.taxRate[this.cart.country+(this.cart.region?":"+this.cart.region:"")];if(d){if(d instanceof Array){a.each(d,function(k,c){e+=c})}else{d=e}h.push(["is_shipping_taxed",i.taxShipping?true:false]);h.push(["tax_rate",e])}}if(this.shipping){h.push(["shipping_method_service_level_1","standard"]);h.push(["shipping_method_price_per_shipment_amount_1",this.shipping])}h.push(["currency_code",i.currencyCode]);this.checkout("https://payments"+(i.sandbox?"-sandbox":"")+".amazon.com/checkout/"+g,h)};
/*! Google Checkout extension for plum.shop | @since 1.0 */
plum.shop.prototype.checkout.google=function(g){var k=this.cart.items.length+1,j=this.options,p=j.classes,l=0,q,m=[],n=new RegExp("^(?:"+p.id+"|"+p.limit+"|"+p.price+"|"+p.quantity+"|"+p.taxable+"|"+p.title+"|"+p.stock+")$"),f="checkout-flow-support.merchant-checkout-flow-support.",e=f+"tax-tables.default-tax-table.tax-rules.default-tax-rule-1.",d=f+"shipping-methods.flat-rate-shipping-1.",h=j.googlemerchant;if(!/^[\d]{10,15}$/.test(h)){return false}this.cart.each(function(r){var c=[],o;r++;m.push(["item_merchant_id_"+r,this[p.id]]);m.push(["item_name_"+r,this[p.title]||""]);m.push(["item_quantity_"+r,this[p.quantity]]);m.push(["item_price_"+r,this[p.price]]);m.push(["item_currency_"+r,j.currencyCode]);for(o in this){if(this[o]!==b&&!n.test(o)){c.push(o+": "+this[o])}}m.push(["item_description_"+r,c.length?c.join(", "):""])});if(this.discount){m.push(["item_merchant_id_"+k,this.cart.discountCode||0]);m.push(["item_name_"+k,this.cart.discountCode||this.format(-this.discount)]);m.push(["item_description_"+k,this.cart.discountCode]);m.push(["item_quantity_"+k,1]);m.push(["item_price_"+k,-this.discount]);m.push(["item_currency_"+k,j.currencyCode])}if(!j.taxIncluded&&this.tax&&typeof j.taxRate==="object"){q=j.taxRate[this.cart.country+(this.cart.region?":"+this.cart.region:"")];if(q){if(q instanceof Array){a.each(q,function(i,c){l+=c})}else{l=q}m.push([e+"shipping-taxed",j.taxShipping?true:false]);m.push([e+"rate",l]);if(this.cart.region){m.push([e+"tax-areas.us-state-area-1.state",this.cart.region])}else{m.push([e+"tax-area.postal-area.country-code",this.cart.country])}}}if(this.shipping){m.push([d+"name",this.cart.shippingMethod]);m.push([d+"price",this.shipping]);m.push([d+"price.currency",j.currencyCode])}if(g){m.push(["shopping-cart.merchant-private-data","invoice: "+g])}this.checkout((j.sandbox?"https://sandbox.google.com/checkout/api/checkout/v2/checkoutForm/Merchant/":"https://checkout.google.com/api/checkout/v2/checkoutForm/Merchant/")+h,m)};
/*! PayPal extension for plum.shop | @since 1.0 */
plum.shop.prototype.checkout.paypal=function(k){var d=0,h=this.options,j=h.classes,g=[],e=new RegExp("^(?:"+j.id+"|"+j.limit+"|"+j.price+"|"+j.quantity+"|"+j.taxable+"|"+j.title+"|"+j.stock+")$"),f={user:h.paypaluser,domain:h.paypaldomain};if(!f.user||!f.domain){return false}this.cart.each(function(){var i,c=0;d++;g.push(["item_number_"+d,this[j.id]]);g.push(["item_name_"+d,this[j.title]||this[j.id]]);g.push(["quantity_"+d,this[j.quantity]]);g.push(["amount_"+d,this[j.price]]);for(i in this){if(this[i]!==b&&!e.test(i)&&c<7){g.push(["on"+c+"_"+d,i]);g.push(["os"+c+++"_"+d,this[i]])}}});if(this.discount){g.push(["discount_amount_cart",this.discount])}if(!h.taxIncluded&&this.tax){g.push(["tax_cart",this.tax])}if(this.shipping){g.push(["custom","shippingMethod: "+this.cart.shippingMethod]);g.push(["handling_cart",this.shipping])}g.push(["cmd","_cart"]);g.push(["lc",h.language]);g.push(["upload","1"]);g.push(["charset","utf-8"]);g.push(["currency_code",h.currencyCode]);g.push(["business",h.paypaluser+"@"+h.paypaldomain]);if(h.headerurl){g.push(["cpp_header_image",h.headerurl])}if(h.cancelurl){g.push(["cancel_return",h.cancelurl])}if(h.returnurl){g.push(["return",h.returnurl])}if(h.notifyurl){g.push(["notify_url",h.notifyurl])}if(k){g.push(["invoice",k])}this.checkout("https://www."+(h.sandbox?"sandbox.":"")+"paypal.com/cgi-bin/webscr",g)};
/*! Skrill extension for plum.shop | @since 1.1 */
plum.shop.prototype.checkout.skrill=function(k){var d=0,h=this.options,j=h.classes,g=[],e=new RegExp("^(?:"+j.limit+"|"+j.price+"|"+j.taxable+"|"+j.title+"|"+j.stock+")$"),f={user:h.skrilluser,domain:h.skrilldomain};if(!f.user||!f.domain){return false}this.cart.each(function(){var i,c=[];d++;g.push(["detail"+d+"_description",this[j.title]]);for(i in this){if(this[i]!==b&&!e.test(i)){c.push(i+": "+this[i])}}g.push(["detail"+d+"_text",c.join(", ")])});d=2;if(this.discount){g.push(["amount"+d+"_description",this.cart.discountCode||""]);g.push(["amount"+d++,(-this.discount).toFixed(2)])}if(!h.taxIncluded&&this.tax){g.push(["amount"+d+"_description","Tax"]);g.push(["amount"+d++,this.tax.toFixed(2)])}if(this.shipping){g.push(["amount"+d+"_description",this.cart.shippingMethod]);g.push(["amount"+d++,this.shipping.toFixed(2)])}g.push(["amount",this.total.toFixed(2)]);g.push(["language",h.language]);g.push(["currency",h.currencyCode]);g.push(["pay_to_email",f.user+"@"+f.domain]);if(h.headerurl){g.push(["logo_url",h.headerurl])}if(h.cancelurl){g.push(["cancel_url",h.cancelurl])}if(h.returnurl){g.push(["return_url",h.returnurl])}if(h.notifyurl){g.push(["status_url",h.notifyurl])}if(k){g.push(["transaction_id",k])}this.checkout("https://www.moneybookers.com/app/payment.pl",g)}}(jQuery));