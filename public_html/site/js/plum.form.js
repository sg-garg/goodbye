/*!
 * plum.form v1.6
 * Copyright 2011-2012 Elia Fierro <http://plumjs.com>
 * Date: 24 August, 2012
 */
(function(a,b){a.expr[":"].plum=function(c){return !!a(c).data("plum-form")};plum.form=function(d,e){var c=plum.form.prototype;if(typeof d==="string"){return this.each(c.validate(e))}d=d||{};d.listen=typeof d.listen==="undefined"?true:d.listen;this.each(c.init(d));if(this.selector&&d.listen){c.selectors[this.selector]=d;c.listen(this.selector)}return this};plum.form.prototype={options:{action:null,ajax:false,classes:{active:"active",arrow:"select-arrow",button:"button",checkbox:"checkbox",checked:"checked",closed:"closed",color:"color",container:"select-container",date:"date",datetime:"datetime",disabled:"disabled",file:"file",filelist:"filelist",focus:"focus",email:"email",error:"error",hover:"hover",info:"info",input:"input",invalid:"invalid",label:"label",loading:"loading",mixed:"mixed",month:"month",multiple:"multiple",number:"number",open:"open",optgroup:"optgroup",option:"option",password:"password",progress:"progress",radio:"radio",range:"range",remove:"remove",reset:"reset",submit:"submit",success:"success",text:"text",textarea:"textarea",select:"select",search:"search",selected:"selected",single:"single",tel:"tel",url:"url",value:"select-value",waiting:"waiting",week:"week",wrapper:"select-wrapper"},json:false,labels:false,reset:false,speed:150,error:function(){},complete:function(){},submit:function(){}},selectors:{},isIE7:navigator.appVersion.indexOf("MSIE 7.")>-1,init:function(d){var c=this;return function(){var g=a(this),h=this.nodeName.toLowerCase()==="form",e=a(":input:not(:hidden,:plum)",this),f=g;if(!h){f=g.closest("form");f=f.length?f:g.find("form");e=g.is(":input")?g:e}if(f.length){if(!f.data("plum-form")){f.attr("novalidate",true).data("plum-form",a())}f.data("plum-form-options",a.extend(true,{},c.options,d));f.unbind("submit",c.submit).bind("submit",c.submit);f.unbind("reset",c.reset).bind("reset",c.reset);e.each(c.wrap(d||{}))}}},bind:function(){var g=this.options.classes,e=this.element,f=this.wrapper,d;if(!/^(?:button|reset|submit|select-one|select-multiple)$/.test(this.type)){f.css({width:parseInt(f.css("width"),10)-parseInt(f.css("borderLeftWidth"),10)-parseInt(f.css("borderRightWidth"),10)})}e.css({width:f.css("width")}).bind("focus blur",function(c){f[c.type==="focus"?"addClass":"removeClass"](g.focus)});f.bind({mousedown:function(){d=true;f.addClass(g.active)},mouseup:function(){d=false;f.removeClass(g.active)},mouseenter:function(){d&&f.addClass(g.active)},mouseleave:function(){f.removeClass(g.active)}})},label:function(){var d=this,f=this.wrapper.parent(),e=[],g=this.options.speed,h=this.options.classes;if(/(?:select-one|select-multiple|file|submit|button|reset|radio|checkbox)/.test(this.type)){return}if(this.element[0].id){e=a('label[for="'+this.element[0].id+'"]')}if(!e.length&&f.is("label")){e=this.wrapper.parent()}if(!e.length){return}this.wrapper.append('<label class="'+h.label+'">'+e.text()+"</label>");if(f.is("label")){e.after(this.wrapper).remove()}else{e.remove()}e=this.wrapper.children("label");e.css({height:this.element.outerHeight(),left:parseInt(this.element.css("paddingLeft"),10),position:"absolute",right:parseInt(this.element.css("paddingRight"),10),top:0,overflow:"hidden"});e.bind("mousedown",false);e.bind("click",function(){d.element.trigger("focus")});this.element.bind({focus:function(){e.animate({opacity:0.4},g,"linear")},blur:function(){e[this.value?"hide":"show"]().animate({opacity:1},g,"linear")},keypress:function(c){if(c.which>0&&c.which!==8&&c.which!==13){e[(this.value+String.fromCharCode(c.which)).length?"hide":"show"]()}},keyup:function(){e[this.value.length?"hide":"show"]()}});if(this.element[0].value){e.hide()}},listen:function(c){var d=this;a("body").bind("plum",function(f,e){a(":input:not(:plum,:hidden)",e).each(function(){if(a(this).closest(c).length){d.init(d.selectors[c]).call(this)}})})},reset:function(d){var c=a(this);window.setTimeout(function(){c.data("plum-form").trigger("blur").each(function(){var e=a(this).data("plum-form"),f=e.options.classes;if(e.reset){e.reset()}e.wrapper.removeClass(f.invalid);e.wrapper.children("div."+f.info).removeClass(f.success+" "+f.error)})},1)},submit:function(h){var g=a(this),d=g.data("plum-form"),e=a(this).data("plum-form-options"),j=e.classes,f,i;if(d.trigger("blur").filter(function(){return a(this).parent().hasClass(j.invalid)}).length||e.submit.call(g[0])===false){e.error.call(g[0]);return false}if(e.ajax){f=d.filter(":file");if(f.length&&!a.support.filexhr){g.attr("target","plum-form")}else{h.preventDefault();i=function(){a.ajax({url:g[0].action,data:g.serialize(),dataType:e.json?json:"",type:g[0].method||"POST",success:function(c){e.reset&&g.trigger("reset");e.complete.call(g[0],c)}})};if(f.length){f.eq(0).data("plum-form").upload(i)}else{i()}}}},wrap:function(d){var c=this;return function(){if(this.parentNode.className.match(/plum-form/)){return}var l={},j=a(this),i=j.closest("form"),h=this.nodeName.toLowerCase(),g=(this.getAttribute("type")||this.type||this.nodeName).toLowerCase(),k=j.css("display"),e=j.css("position"),f=new (typeof plum.form[g]==="function"?plum.form[g]:typeof plum.form[h]==="function"?plum.form[h]:typeof plum.form.input==="function"?plum.form.input:function(){});f.options=a.extend(true,{},c.options,f.options,d);l=f.options.classes;f.type=g;f.element=j.data("plum-form",f);f.wrapper=j.wrap(a("<div>",{title:this.title,dir:this.dir,"class":"plum-form "+(l[g]||"")+" "+(l[h]||"")+" "+(this.disabled&&l.disabled||""),css:{display:k==="inline"&&!c.isIE7?"inline-block":k,position:e==="static"?"relative":e,"float":j.css("float"),width:/(?:checkbox|radio|button|submit|reset)/.test(g)?"":this.offsetWidth}})).parent();i.data("plum-form",i.data("plum-form").add(f.element));c.bind.call(f);f.init&&f.init();f.options.labels&&c.label.call(f);if(c.isIE7&&!/(?:button|submit|reset)/.test(g)){f.element.css({width:f.element.width()-(f.element.outerWidth()-f.wrapper.outerWidth())-parseInt(f.element.css("borderLeftWidth"),10)-parseInt(f.element.css("borderRightWidth"),10)})}}},validate:function(f){var e=this,g=this.options.classes,d=this.validate.methods;return function(){var c=a(this).data("plum-form"),h;if(!c){return}h=a('<div class="'+g.info+'">').insertAfter(this);c.element.bind("blur",function(){var j=true,k,i;h.attr("title","").empty();switch(typeof f){case"string":j=this.value===f;break;case"function":j=!!f.call(this);break;default:if(f instanceof Array){j=a.inArray(this.value,f)>-1}else{if("min" in f){if(this.type==="checkbox"||this.type==="radio"){i=a(":"+this.type+'[name="'+this.name+'"]');j=i.filter(":checked").length>=f.min}else{j=this.value.length>=f.min}}"max" in f&&(j=j&&this.value.length<=f.max);if("method" in f&&j){if(f.method instanceof Array){j=a.inArray(this.value,f.method)>-1}else{k=d[f.method]?d[f.method]:typeof f.method==="object"&&f.method.test?f.method:typeof f.method==="function"?f.method:false;j=k?(k.test?k.test(this.value):k.call(this)):false;"min" in f&&!f.min&&!this.value&&(j=true)}}else{if(f.test){j=f.test(this.value)}}if(!j){"message" in f&&h.text(f.message);"title" in f&&h.attr("title",f.title)}}break}(i?i.parent():c.wrapper)[j?"removeClass":"addClass"](g.invalid);(i?i.find("div."+g.info).empty():h).removeClass(j?g.error:g.success).addClass(j?g.success:g.error)})}}};plum.form.prototype.validate.methods={email:/^(?:"[\w!#$%&'\*+\.\-\/=?\^_`{|}~]+"|[\w!#$%&'\*+\.\-\/=?\^_`{|}~]+)@(?:\w(?:\-?\w+?)*?\w\.)+(?:[a-z]{2}\.)?[a-z]{2,6}$/,tel:/^(?:(?:\+?1\s*(?:[\.\-]\s*)?)?(?:\(\s*([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9])\s*\)|([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9]))\s*(?:[\.\-]\s*)?)?([2-9]1[02-9]|[2-9][02-9]1|[2-9][02-9]{2})\s*(?:[\.\-]\s*)?([0-9]{4})(?:\s*(?:#|x\.?|ext\.?|extension)\s*(\d+))?$/,url:/^(?:https?:\/\/)?(?:\w(?:\-?\w+?)*?\w\.)+(?:[a-z]{2}\.)?[a-z]{2,6}(\/\S+)?$/};plum.form.checkbox=function(){};plum.form.checkbox.prototype={init:function(){var d=this,h=this.options.classes,e=this.wrapper,g=this.element.closest("form"),f=this.element.bind("click",function(){var c,i=f.attr("class");i=i?i.match(/check-all-([^\s]+)/):"";i=i?i[1]:"";if(!i){e.toggleClass(h.checked);d.checkall(this.name)}else{g.data("plum-form").filter(function(){return this.type==="checkbox"&&!this.disabled&&(this.name===i||a(this).hasClass("check-all-"+i))}).each(function(){var j=a(this).parent();if(f[0].checked||j.hasClass(h.mixed)){this.checked=true;j.removeClass(h.mixed).addClass(h.checked)}else{this.checked=false;j.removeClass(h.checked+" "+h.mixed)}})}}).css({left:"50%",marginLeft:-this.element[0].offsetWidth/2,marginTop:-this.element[0].offsetHeight/2,opacity:0,position:"absolute",top:"50%"});e.css({verticalAlign:""});f[0].checked&&e.addClass(h.checked);d.checkall()},checkall:function(e){var f=this.options.classes,d=this.element.closest("form");d.data("plum-form").filter(function(){return this.type==="checkbox"&&!this.disabled&&/check-all-([^\s]+)/.test(this.className)&&(!e||a(this).hasClass("check-all-"+e))}).each(function(){var i=a(this),g=i.parent(),j=this.className.match(/check-all-([^\s]+)/)[1],c=d.data("plum-form").filter(function(){return this.type==="checkbox"&&!this.disabled&&this.name===j&&!/check-all-([^\s]+)/.test(this.className)}),h=c.filter(":checked");if(h.length===0){this.checked=false;g.removeClass(f.checked+" "+f.mixed)}else{this.checked=true;if(h.length===c.length){g.removeClass(f.mixed).addClass(f.checked)}else{g.addClass(f.checked+" "+f.mixed)}}})},reset:function(){this.wrapper[this.element[0].checked?"addClass":"removeClass"](this.options.classes.checked);this.checkall()}};plum.form.file=function(){};plum.form.file.prototype={options:{file:{autoupload:false,button:"Choose a file...",complete:function(){},errorsize:"Please choose a file smaller than {filesize}.",errortype:"Allowed file types: {filetype}.",files:0,html:'<span class="filename">{filename}</span><span class="remove">&times;</span><span class="filesize">{filesize}</span><div class="progress"><div></div></div>',progress:function(c){c.progressbar.children().stop(true,true).animate({width:c.percent+"%"},150)},size:0,start:function(){},types:[]}},init:function(){var l=this.options.classes,k=this.options.file,j=this.element,h=this.wrapper,i=j.closest("form"),g=i.data("plum-form-upload")||a(),e,d;i.data("plum-form-upload",g.add(j));this.support();j.data("plum-form-queue",[]);j.data("plum-form-index",0);j.attr("multiple",true).addClass("plum-form-0");j.attr("tabindex",-1);j.css({opacity:0,position:"absolute",width:50});j.before(this.create("button"));h.children().wrapAll(this.create("wrapper"));h.append(this.create("list"));e=a(":button",h).parent();j.bind("change",this.change);j.bind("mousedown",function(){d=true;h.addClass(l.active)});j.bind("mouseup",function(){d=false;h.removeClass(l.active)});j.bind("focus",function(){h.removeClass(l.focus);e.addClass(l.focus)});j.bind("blur",function(){h.removeClass(l.focus);e.removeClass(l.focus)});e.bind("mouseover",function(){e.addClass(l.hover);d&&e.addClass(l.active)});e.bind("mouseout",function(){e.removeClass(l.hover+" "+l.active)});e.bind("mousemove",function(f){var c=a(":file",this).eq(-1);c.css({left:-c.outerWidth(),marginLeft:f.pageX-e.offset().left+25,top:f.pageY-e.offset().top-10})})},add:function(f){var e=this.element.data("plum-form-queue"),g=this.options.speed,h=this.options.classes,d=this.wrapper.find("ul").append(this.create("item",f)).children(":last-child").fadeIn(g);a("."+h.remove,d).bind("click",function(){var j=d[0].className.match(/(?:(?:.+\s+)?)?plum-upload-([\d]+)/)[1],c=a(":file.plum-upload-"+j);d.fadeOut(g,function(){d.remove()});typeof e[j]!=="undefined"&&e.splice(j,1);!a.support.file&&c.remove()});if(f.error||!a.support.filexhr){a("."+h.progress,d).remove()}else{a("."+h.progress,d).children().css({width:0})}},change:function(){var e=a(this),j=e.data("plum-form"),k=e.data("plum-form-queue"),n=e.data("plum-form-index"),q=j.options,o={name:this.value,size:"",type:"",error:""},h=0,g,p=q.classes,m=q.file,d;if(a.support.file){if(!q.ajax&&!m.autoupload){k=[];j.wrapper.find("ul").empty()}for(g=this.files.length;h<g;h++){if(m.files&&j.queue.length===m.files){break}d=this.files[h];o.name=d.name||d.fileName;o.size=d.size||d.fileSize;o.type=d.type||d.fileType;o.error=m.size&&o.size>m.size?"<div>"+m.errorsize+"</div>":m.types.length&&a.inArray(o.type,m.types)<0?"<div>"+m.errortype+"</div>":"";if(!o.error){n++;k.push(d)}j.add(o)}m.autoupload&&j.upload()}else{if(m.files&&j.queue.length<=m.files){o.name=o.name.substring(o.name.lastIndexOf("\\")+1);n++;k.push(this.value);j.add(o);e.css({zIndex:-998});e.unbind("change",j.change);e.after(e.clone().val(""));e=e.next();e.data("plum-form",j);e.removeClass("plum-upload-"+(n-1));e.addClass("plum-upload-"+n);e.css({zIndex:998});e.bind("change",j.change)}}e.data("plum-form-queue",k);e.data("plum-form-index",n)},create:function(e,d){var i=this.options.classes,g=this.options.file;switch(e){case"button":var h=this.wrapper[0].title;this.wrapper[0].title="";this.element[0].title="";return a('<button type="button">'+(h||g.button)+"</button>");case"item":return a("<li>",{"class":(d.error?i.error:i.waiting)+" plum-upload-"+this.element.data("plum-form-index"),css:{display:"none"},html:g.html.replace(/\{filename\}/g,d.name).replace(/\{filesize\}/g,this.size(d.size)).replace(/\{filetype\}/g,d.type)+d.error.replace(/\{filesize\}/g,this.size(g.size)).replace(/\{filetype\}/g,g.types.join(", "))+'<div style="clear:both"></div>'});case"list":return a("<ul>",{"class":i.filelist});case"wrapper":return a("<div>",{"class":"plum-form "+i.input+" "+i.button,css:{display:"inline-block",overflow:"hidden",position:"relative",verticalAlign:"top",width:plum.form.prototype.isIE7?"auto":"",zoom:plum.form.prototype.isIE7?1:""}});default:break}},size:function(c){c={B:c};c.K=c.B/1024;c.M=c.K/1024;c.G=c.M/1024;return c.G>1?Math.round(c.G)+" GB":c.M>1?Math.round(c.M)+" MB":c.K>1?Math.round(c.K)+" KB":c.B>0?c.B+" bytes":""},support:function(){a.support.file=window.File&&window.FileList;a.support.filexhr=window.XMLHttpRequestUpload;if(!a.support.filexhr&&!a('iframe[name="plum-form"]').length){a('<iframe name="plum-form">').attr("src","about:blank").css({border:0,left:"-9999em",height:0,position:"absolute",top:"-9999em",width:0}).appendTo("body")}},reset:function(){this.element.data("plum-form-queue",[]);this.element.data("plum-form-index",0);this.wrapper.find(":file:gt(0)").remove();this.wrapper.find("li").fadeOut(this.options.speed,"linear",function(){a(this).remove()})},upload:function(m){var i=this,g=this.element,d=g.closest("form"),e=d.data("plum-form-upload"),j=g.data("plum-form-queue");if(!j.length){e=e.slice(1);d.data("plum-form-upload",e);return !e.length?(m?m():function(){}):e.eq(0).data("plum-form").upload(m)}var o=this.options,k=o.classes,l=this.wrapper.find("li:eq(0)"),f=j.shift(),h=a("."+k.progress,l).slideDown(o.speed),n;n=new XMLHttpRequest;n.upload.addEventListener("loadstart",function(c){l.toggleClass(k.waiting+" "+k.loading);o.file.start.call(l,a.extend(c,{progressbar:h,percent:c.loaded/c.total*100}))},false);n.upload.addEventListener("progress",function(c){o.file.progress.call(l,a.extend(c,{progressbar:h,percent:c.loaded/c.total*100}))},false);n.onreadystatechange=function(c){if(n.readyState===4){o.file.complete.call(l,a.extend(c,{progressbar:h,percent:100}),o.json?a.parseJSON(n.responseText):n.responseText);l.fadeOut(o.speed,function(){l.remove();i.upload(m)})}};n.open("POST",d[0].action,true);n.setRequestHeader("Content-Type",f.type);n.setRequestHeader("X-File-Name",f.name);n.setRequestHeader("X-Requested-With","XMLHttpRequest");n.send(f)}};plum.form.input=function(){};plum.form.input.prototype={init:function(){var e=this.options.classes,d=this.element;switch(this.type){case"textarea":d.css({resize:"none",verticalAlign:"bottom"});break;case"button":case"submit":case"reset":d.attr("formnovalidate",true);break;default:d.css({verticalAlign:"bottom"});this.wrapper.addClass(e.text);break}}};plum.form.radio=function(){};plum.form.radio.prototype={init:function(){var g=this.options.classes,d=this.wrapper,f=this.element.closest("form"),e=this.element.bind("click",function(){f.data("plum-form").filter(function(){return this.type==="radio"&&this.name===e[0].name}).each(function(){a(this).parent().removeClass(g.checked)});d.addClass(g.checked)}).css({left:"50%",marginLeft:-this.element[0].offsetWidth/2,marginTop:-this.element[0].offsetHeight/2,opacity:0,position:"absolute",top:"50%"});d.css({verticalAlign:""});e[0].checked&&d.addClass(g.checked)},reset:function(){this.wrapper[this.element[0].checked?"addClass":"removeClass"](this.options.classes.checked)}};plum.form.select=function(){};plum.form.select.prototype={list:"",string:"",innerwrapper:null,container:null,valuecontainer:null,selected:null,menuoptions:null,original:[],values:[],end:0,index:0,height:0,liHeight:0,maxHeight:0,multiple:false,isopen:false,init:function(){var e=this.element[0],f=this.options.classes,d=this;this.wrapper.addClass(e.multiple?f.multiple+" "+f.open:f.single+" "+f.closed);this.multiple=e.multiple;this.innerwrapper=this.wrapper.prepend(this.create("inner")).children("div");this.valuecontainer=this.innerwrapper.append(this.create("value")).children("div");this.selected=this.valuecontainer.html(this.create("arrow")).children("div:first-child");this.container=this.innerwrapper.append(this.create("menu",{width:e.offsetWidth})).children("ul");this.wrapper.bind("mousedown",false);this.element.bind("rebuild",a.proxy(this.rebuild,this)).bind("change",this.close).bind("keydown",a.proxy(this.keydown,this)).bind("keypress",a.proxy(this.keypress,this)).trigger("rebuild");this.container.css({width:""});this.valuecontainer.css({left:0,overflow:"hidden",position:"absolute",right:0,whiteSpace:"nowrap"});this.selected.css({overflow:"hidden",maxWidth:this.selected.width()-this.valuecontainer.children().eq(1).width()-parseInt(this.valuecontainer.css("paddingLeft"),10)-parseInt(this.valuecontainer.css("paddingRight"),10)});if(e.multiple){this.element.css({position:"absolute",top:0,zIndex:-999});return}this.container.css({position:"absolute"});a(document).bind("click",function(g){g=a(g.target);var h=d.options.classes;if(g.closest("div.plum-form."+h.select)[0]!==d.wrapper[0]){d.isopen&&d.close();return this}if(e.disabled||g.hasClass(h.disabled)||g.is("label")||g.is("li")){return this}d[d.isopen?"close":"open"]()})},create:function(e,d){var f=this.options.classes;return function(){switch(e){case"arrow":return a('<div></div><div class="'+f.arrow+'"></div>');case"inner":return a('<div class="'+f.wrapper+'">');case"menu":return a('<ul class="'+f.container+'">').css({minWidth:d.width,overflowX:"hidden",overflowY:"scroll",position:"relative",whiteSpace:"nowrap",width:d.width});case"value":return a('<div class="'+f.value+'">').css({position:"relative",verticalAlign:"bottom"})}}},click:function(d,f){var j=d.target,k=this.options.classes,i=this.menuoptions.index(j),h=this.original[i],l=0,e=0,g=0;if((d.metaKey||d.ctrlKey)&&this.multiple){a(this).toggleClass(k.selected);h.selected=!h.selected;this.index=i}else{if(d.shiftKey&&this.multiple){e=i<this.index?i:this.index;g=i<this.index?this.index:i;a.each(this.original,function(){this.selected=false});this.menuoptions.removeClass(k.selected);for(;e<=g;){this.original[e].selected=true;this.menuoptions.eq(e++).addClass(k.selected)}}else{a(j).addClass(k.selected);h.selected=true;this.end=i;this.index=i;this.menuoptions.not(j).removeClass(k.selected);!this.multiple&&this.selected.text(this.values[i])}}l=this.liHeight*this.index;if(l<this.container.scrollTop()){this.container.scrollTop(l)}else{if(l>this.height-this.liHeight){this.container.scrollTop(l-this.height+this.liHeight)}}!f&&this.element.trigger("change")},close:function(){var d=this.wrapper?this:a(this).data("plum-form"),e=d.options.classes;if(this.multiple||!d.isopen){return}d.wrapper.css({zIndex:998});d.container.slideUp(d.options.speed,"linear",function(){d.element.trigger("close");d.wrapper.css({zIndex:""}).toggleClass(e.open+" "+e.closed);d.isopen=false})},open:function(){var e=this,i=this.options.classes,h=this.options.speed,d=a(document).height(),f=this.wrapper.offset().top,g=0;if(f+this.height+50>d){g=d-f-this.height-50}if(g*-1>f+25){g=-f+25}this.isopen=true;this.element.trigger("focus").trigger("open");this.wrapper.css({zIndex:999}).toggleClass(i.open+" "+i.closed);this.container.stop(true,true).animate({marginTop:g},h,"linear");this.container.stop(true,true).slideDown(h,"linear",function(){e.container.scrollTop(e.liHeight*e.index)})},keydown:function(e){var f=this.options.classes,d=0;switch(e.which){case 8:this.string=this.string.substring(0,this.string.length-1);e.preventDefault();break;case 13:this.element.trigger("change");break;case 9:case 27:this.close();break;case 38:case 40:if(!(e.ctrlKey||e.metaKey)){this.end=e.which===38?this.end-1>=0?this.end-1:0:this.end+1<this.original.length?this.end+1:this.original.length-1;if(this.end!==this.index){e.target=this.menuoptions.eq(this.end)[0];this.click.call(this,e,true)}e.preventDefault()}break;default:break}},keypress:function(e){var f=this.options.classes,d=0;if(e.which!==13&&e.which!==8){this.string+=String.fromCharCode(e.which);d=this.search(this.string);if(d>-1){this.click.call(this.menuoptions.eq(d)[0],e)}}},search:function(d){d=d.toLowerCase();for(var e=0,c=this.values.length;e<c;e++){if(this.values[e].toLowerCase().substring(0,d.length)===d){return e}}return -1},optionlist:function(){var f=a(this),d=f.closest(".plum-form").find("select").data("plum-form"),h=d.options.classes,e=this.nodeName.toLowerCase(),g=this.label||this.textContent||this.innerText;d.list+='<li class="'+h[e]+" "+(this.disabled&&h.disabled||"")+" "+(this.selected&&h.selected||"")+'">';if(e==="option"){d.list+=g;if(!this.disabled){d.original.push(this);d.values.push(g)}}else{d.list+="<label>"+g+"</label><ul>";f.children().each(d.optionlist);d.list+="</ul>"}d.list+="</li>"},rebuild:function(f){var e=a(f.target),d=e.data("plum-form"),g=d.options.classes;d.original=[];d.values=[];d.list="";d.element.children().each(d.optionlist);d.container.show().html(d.list);d.liHeight=a("li."+g.option,d.container).eq(0).outerHeight(true);d.maxHeight=d.liHeight*(this.size||(this.multiple?5:10));a.each(d.original,function(c){if(this.selected){d.index=c;d.end=c;return false}});if(d.container.height()<d.maxHeight){d.container.css("overflowY","auto")}d.container.css({display:this.multiple?"block":"none",maxHeight:d.maxHeight});d.height=d.container.outerHeight(true);d.menuoptions=d.container.find("li."+g.option+":not(."+g.disabled+")").bind("click",a.proxy(d.click,d));d.wrapper[this.disabled?"addClass":"removeClass"](g.disabled).css({width:d.container.outerWidth(true)});!this.multiple&&d.selected.text(e.find("option[selected]").filter(":last").text()||e.find("option:eq(0)").text())},reset:function(){var d=this,e=this.element.val(),f=this.options.classes;this.end=0;this.menuoptions.removeClass(f.selected);if(typeof e==="object"){a.each(e,function(g,c){a.each(d.original,function(h){if(this.value===c){d.menuoptions.eq(h).addClass(f.selected)}})})}else{a.each(this.original,function(c){if(this.value===e){d.menuoptions.eq(c).addClass(f.selected)}})}a.each(this.original,function(c){if(this.selected){d.index=c;return false}})}}}(jQuery));